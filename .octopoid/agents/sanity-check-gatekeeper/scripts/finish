#!/opt/homebrew/opt/python@3.13/bin/python3.13
"""Mark task as complete and write result.json."""

import json
import os
import sys
from pathlib import Path

TASK_ID = os.environ.get("TASK_ID", "")
SERVER_URL = os.environ.get("OCTOPOID_SERVER_URL", "")
RESULT_FILE = os.environ.get("RESULT_FILE", "../result.json")


def main() -> int:
    result_path = Path(RESULT_FILE)

    # Read existing result if submit-pr already wrote one
    existing = {}
    if result_path.exists():
        try:
            existing = json.loads(result_path.read_text())
        except (json.JSONDecodeError, OSError):
            pass

    # Merge with finish outcome
    existing.setdefault("outcome", "done")

    result_path.write_text(json.dumps(existing, indent=2))
    print(f"Task {TASK_ID} marked as complete")
    return 0


if __name__ == "__main__":
    sys.exit(main())
